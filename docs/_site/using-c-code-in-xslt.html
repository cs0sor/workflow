<!DOCTYPE html>
<html lang="en">
<head>
    <title>Using C# Code in XSLT</title>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,600,900" rel="stylesheet">
    <link rel="stylesheet" href="css/github.css">
    <link rel="stylesheet" href="css/nav.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/style.css">
 </head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="xcontainer">
        <div class="navbar-header">
            <a class="navbar-brand" title="Go to Zynk.com" href="http://zynk.com"><img class="img-responsive" id="logo-main" src="assets/logo.svg" alt="Click here to visit Zynk.com" /></a>
        </div>
        <div id="myNavbar">
                <ul class="nav navbar-nav navbar-right">
                    <li class="topnav-2"><a href="mailto:support@zynk.com">support@zynk.com</a></li>
                </ul>
        </div>
    </div>
</nav>

<div id="wrapper">

    <!-- Sidebar -->
    <div id="sidebar-wrapper" class="sidebar-nav">
        
        <h1>Zynk Workflow Documentation</h1>
<ul>
  <li><a href="index">Home</a>
    <ul>
      <li>[[Getting Started]]</li>
      <li>[[Key Concepts]]</li>
      <li>[[Using Zynk]]</li>
      <li>[[Settings]]</li>
      <li>[[Extensions]]</li>
      <li>[[Integrations]]</li>
    </ul>
  </li>
  <li>[[Accounting]]
    <ul>
      <li>[[Sage 50 UK]]</li>
      <li>[[Sage 200]]</li>
      <li>[[Sage 200 Online]]</li>
      <li>[[Xero]]</li>
      <li>[[Kashflow]]</li>
      <li>[[Quickbooks Online]]</li>
      <li>[[Sage 50 US]]</li>
      <li>[[Brightpearl]]</li>
      <li>[[Sage One]]</li>
      <li>[[Sage 50 Payroll]]</li>
      <li>[[Sage 50 UK Reporting]]</li>
    </ul>
  </li>
  <li>[[CRM]]
    <ul>
      <li>[[ACT]]</li>
      <li>[[AutoTask]]</li>
      <li>[[BXP]]</li>
      <li>[[Campaign Monitor]]</li>
      <li>[[ConnectWise]]</li>
      <li>[[Salesforce]]</li>
      <li>[[Sugar CRM]]</li>
      <li>[[Zoho CRM]]</li>
    </ul>
  </li>
  <li>[[Databases]]
    <ul>
      <li>[[SQL Server]]</li>
      <li>[[SQLite]]</li>
      <li>[[ODBC]]</li>
      <li>[[OLEDB]]</li>
    </ul>
  </li>
  <li>[[Ecommerce]]
    <ul>
      <li>[[Amazon Marketplace]]</li>
      <li>[[Amazon Vendor Central]]</li>
      <li>[[BigCommerce]]</li>
      <li>[[Channel Advisor]]</li>
      <li>[[CoreCommerce]]</li>
      <li>[[Easy Webstore]]</li>
      <li>[[Ebay]]</li>
      <li>[[EKM Powershop]]</li>
      <li>[[Magento V1]]</li>
      <li>[[Magento V2]]</li>
      <li>[[PayPal]]</li>
      <li>[[Shopify]]</li>
      <li>[[WooCommerce]]</li>
    </ul>
  </li>
  <li>[[Files]]
    <ul>
      <li>[[CSV]]</li>
      <li>[[HTML]]</li>
      <li>[[Excel]]</li>
      <li>[[File]]</li>
      <li>[[File Helpers]]</li>
      <li>[[JSON]]</li>
      <li>[[PDF]]</li>
      <li>[[XML and XSLT]]</li>
    </ul>
  </li>
  <li>[[Cloud]]
    <ul>
      <li>[[Amazon S3]]</li>
    </ul>
  </li>
  <li>[[Social]]
    <ul>
      <li>[[LinkedIn]]</li>
      <li>[[Twitter]]</li>
      <li>[[Facebook]]</li>
    </ul>
  </li>
  <li>[[Web]]
    <ul>
      <li>[[Email]]</li>
      <li>[[FTP]]</li>
      <li>[[SFTP]]</li>
      <li>[[HTTP]]</li>
    </ul>
  </li>
  <li>[[Other]]
    <ul>
      <li>[[Developer]]</li>
      <li>[[SMS]]</li>
      <li>[[User Interface]]</li>
      <li>[[WordPress]]</li>
      <li>[[Zynk Core]]</li>
    </ul>
  </li>
  <li>[[Contact Us]]</li>
</ul>

    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 markdown-body">
                    <a onclick="history.go(-1)" href="#"><span class="fa fa-arrow-left"></span>Back</a>
                    <h1>Using C# Code in XSLT</h1>
                    <p>You may sometimes find that its not possible to do something you require using XSLT, such as checking whether an external file exists before attempting to load it. You often get around limitations in XSLT by writing a C# script to perform the function instead, which can then be called in your XSLT. An example XSLT is shown below which includes a C# script to check if a file exists.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;xsl:stylesheet</span>  <span class="na">version=</span><span class="s">"1.0"</span> 
  <span class="na">xmlns:xsl=</span><span class="s">"http://www.w3.org/1999/XSL/Transform"</span> 
  <span class="na">xmlns:msxsl=</span><span class="s">"urn:schemas-microsoft-com:xslt"</span>
  <span class="na">xmlns:cs=</span><span class="s">"urn:cs"</span> 
  <span class="na">exclude-result-prefixes=</span><span class="s">"msxsl cs"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;xsl:output</span> <span class="na">method=</span><span class="s">"html"</span> <span class="na">indent=</span><span class="s">"yes"</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">"OrderSuccessFile"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">"OrderFailFile"</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;msxsl:script</span> <span class="na">language =</span><span class="s">"C#"</span> <span class="na">implements-prefix=</span><span class="s">"cs"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;![CDATA[
    public bool Valid(string fileName)
    {
      // Check if the file exists
      if (System.IO.File.Exists(fileName))
      {
        // Check the file is parsable
        System.Xml.XmlDocument xmlDoc = new System.Xml.XmlDocument();
        try
        {
          xmlDoc.Load(fileName);
          xmlDoc = null;
          return true;
        }
        catch
        {
          return false;
        }
      }
      else
      {
        return false;
      }
    }
    ]]&gt;</span>
  <span class="nt">&lt;/msxsl:script&gt;</span>

  <span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"/"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;html&gt;</span>
        <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;style&gt;</span>
          * {  font-family:verdana; }
          body,td,th { font-size: 75%; }
          h1 {font-size: 150%; font-weight:normal; margin-top:10; text-align: center;}
          h2 {font-size: 120%; font-weight:normal; margin-top:25;}
        <span class="nt">&lt;/style&gt;</span>
      <span class="nt">&lt;/head&gt;</span>

      <span class="nt">&lt;body&gt;</span>

        <span class="nt">&lt;h1&gt;</span>Zynk Automation Report<span class="nt">&lt;/h1&gt;</span>

        <span class="c">&lt;!-- Output successful order imports if a valid success file is provided --&gt;</span>
        <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">"cs:Valid($OrderSuccessFile)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">"ProcessSalesOrders"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">select=</span><span class="s">"$OrderSuccessFile"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/xsl:call-template&gt;</span>
        <span class="nt">&lt;/xsl:if&gt;</span>

        <span class="c">&lt;!-- Output failed order imports if a valid fail file is provided --&gt;</span>
        <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">"cs:Valid($OrderFailFile)"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">"ProcessSalesOrders"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">select=</span><span class="s">"$OrderFailFile"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/xsl:call-template&gt;</span>
        <span class="nt">&lt;/xsl:if&gt;</span>
      <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;/html&gt;</span>
  <span class="nt">&lt;/xsl:template&gt;</span>

  <span class="nt">&lt;xsl:template</span> <span class="na">name=</span><span class="s">"ProcessSalesOrders"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">"file"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"count"</span> <span class="na">select=</span><span class="s">"count(document($file)/Company/SalesOrders/SalesOrder)"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">"$count &gt; 0"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;table</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">bgcolor=</span><span class="s">"#ffffff"</span> <span class="na">border=</span><span class="s">"0"</span> <span class="na">cellspacing=</span><span class="s">"1"</span> <span class="na">cellpadding=</span><span class="s">"2"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
          <span class="nt">&lt;th</span> <span class="na">bgcolor=</span><span class="s">"#eeeeee"</span> <span class="na">align=</span><span class="s">"left"</span><span class="nt">&gt;&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"concat($ExternalSystem, &amp;#39; Order Id&amp;#39;)"</span> <span class="nt">/&gt;&lt;/th&gt;</span>
          <span class="nt">&lt;th</span> <span class="na">bgcolor=</span><span class="s">"#eeeeee"</span> <span class="na">align=</span><span class="s">"left"</span><span class="nt">&gt;</span>Sales Order Number<span class="nt">&lt;/th&gt;</span>
          <span class="nt">&lt;th</span> <span class="na">bgcolor=</span><span class="s">"#eeeeee"</span> <span class="na">align=</span><span class="s">"left"</span><span class="nt">&gt;</span>Account<span class="nt">&lt;/th&gt;</span>
          <span class="nt">&lt;th</span> <span class="na">bgcolor=</span><span class="s">"#eeeeee"</span> <span class="na">align=</span><span class="s">"left"</span><span class="nt">&gt;</span>Date<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>

        <span class="nt">&lt;xsl:for-each</span> <span class="na">select=</span><span class="s">"document($file)/Company/SalesOrders/SalesOrder"</span><span class="nt">&gt;</span>
          <span class="c">&lt;!-- Output key order info --&gt;</span>
          <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">bgcolor=</span><span class="s">"#ffffff"</span><span class="nt">&gt;&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"Id"</span><span class="nt">/&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">bgcolor=</span><span class="s">"#ffffff"</span><span class="nt">&gt;&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"SalesOrderNumber"</span><span class="nt">/&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">bgcolor=</span><span class="s">"#ffffff"</span><span class="nt">&gt;&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"AccountReference"</span><span class="nt">/&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;td</span> <span class="na">bgcolor=</span><span class="s">"#ffffff"</span><span class="nt">&gt;&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"SalesOrderDate"</span><span class="nt">/&gt;&lt;/td&gt;</span>
          <span class="nt">&lt;/tr&gt;</span>

          <span class="c">&lt;!-- Output error information (if any) --&gt;</span>
          <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">"count(Errors/Error) &gt; 0"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
              <span class="nt">&lt;td</span> <span class="na">bgcolor=</span><span class="s">"#ffd0d0"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;strong&gt;</span>Error Name<span class="nt">&lt;/strong&gt;</span>
              <span class="nt">&lt;/td&gt;</span>
              <span class="nt">&lt;td</span> <span class="na">bgcolor=</span><span class="s">"#ffd0d0"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;xsl:attribute</span> <span class="na">name=</span><span class="s">"colspan"</span><span class="nt">&gt;</span>3<span class="nt">&lt;/xsl:attribute&gt;</span>
                <span class="nt">&lt;strong&gt;</span>Error Description<span class="nt">&lt;/strong&gt;</span>
              <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>

            <span class="nt">&lt;xsl:for-each</span> <span class="na">select=</span><span class="s">"Errors/Error"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">bgcolor=</span><span class="s">"#ffd0d0"</span><span class="nt">&gt;&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"Name"</span><span class="nt">/&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">bgcolor=</span><span class="s">"#ffd0d0"</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;xsl:attribute</span> <span class="na">name=</span><span class="s">"colspan"</span><span class="nt">&gt;</span>3<span class="nt">&lt;/xsl:attribute&gt;</span>
                  <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"Description"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/td&gt;</span>
              <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/xsl:for-each&gt;</span>
          <span class="nt">&lt;/xsl:if&gt;</span>
        <span class="nt">&lt;/xsl:for-each&gt;</span>
      <span class="nt">&lt;/table&gt;</span>
      <span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/xsl:if&gt;</span>
  <span class="nt">&lt;/xsl:template&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span>
</code></pre>
</div>

<p>In order to use C# scripts within an XSLT, you first need to add the msxsl and cs namespaces as shown in the example above. The example shows a method called <code class="highlighter-rouge">Valid</code> which is in the <code class="highlighter-rouge">&lt;msxsl:script language ="C#" implements-prefix="cs"&gt;</code> node. It checks the file path provided in the <code class="highlighter-rouge">fileName</code> parameter exists and can be parsed as XML. It is called when required using the XPath <code class="highlighter-rouge">cs:Valid($OrderSuccessFile)</code>.</p>

                    <hr>
                    <div class="row">
                        <div class="col-sm-6"><a onclick="history.go(-1)" href="#"><span class="fa fa-arrow-left"></span>Back</a></div>
                        <div class="col-sm-6 text-right"><a href="http://github.com/workflow/docs/tree/master/_documentation/Using-Zynk-Section/Using-C#-Code-in-XSLT.md"><span class="fa fa-github"></span>Edit on Github</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /#page-content-wrapper -->
</div>
<!-- /#wrapper -->


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<!-- Menu Toggle Script -->
<script>
    $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>



<script>
    var screenWidth = $(window).width();

    // Add .active class to active link + scroll into view
    var pathinfo = location.pathname + location.hash;
    if (screenWidth > 768 && pathinfo != "/")
    {
        var scrollItem = $("#sidebar-wrapper").find("a[href='" + pathinfo + "']")
                .addClass('active')
                .parents().filter("div>ul>li")[0];
        if (scrollItem) {
            scrollItem.scrollIntoView({
                behavior: "smooth",
                block: "start"
            });
        }
    }

    // Add external link icon next to external menu links
    $(".sidebar-nav a[href^=http]")
        .append('<i class="fa fa-external-link" style="margin-left:-15px"></i>');

    $("#menu-toggle").click(function(){
        $("#sidebar-wrapper").scrollTop(0);
        $(this).toggleClass("fa-angle-down");
        $("#wrapper").toggleClass("menu-collapsed");
    });

    if (screenWidth <= 768) {
        $("#menu-toggle").click();            
    }

    //Allow clicking on non-linked headers to jump to its #href
    $("h2,h3,h4").click(function(){
        if (this.id && this.innerHTML.indexOf("<a") == -1) {
            location.href = "#" + this.id;
        }
    });

    
    
    //should no longer be needed now that we're referencing server-side /slug permalinks
(function () {
    "use strict";
    String.prototype.replaceAll = function(search, replacement) {
        var target = this;
        return target.split(search).join(replacement);
    };

    function fixDoubleBracketLinks(cssSelector) {
        var sidebarText = $(cssSelector)[0].innerHTML;
        var matches = sidebarText.match(/\[\[(.+?)\]\]/g);
        var result = sidebarText;
        if(matches != null) {
            for(var i = 0; i < matches.length; i++) {
                var text = matches[i].replaceAll('[[','').replaceAll(']]','');
                result = result.replace(matches[i],
                    '<a href="' +
                    encodeURIComponent(text.replaceAll(' ','-').toLocaleLowerCase()) +
                    '">' + text + '</a>')
            }
            $(cssSelector).html(result);
        }
    }

    fixDoubleBracketLinks('#page-content-wrapper');
    fixDoubleBracketLinks('#sidebar-wrapper');
})();
    
</script>
    
    
    
</body>
</html>
