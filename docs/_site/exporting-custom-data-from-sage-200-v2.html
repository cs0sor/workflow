<!DOCTYPE html>
<html lang="en">
<head>
    <title>Exporting Custom Data from Sage 200 (V2)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,600,900" rel="stylesheet">
    <link rel="stylesheet" href="css/github.css">
    <link rel="stylesheet" href="css/nav.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/style.css">
 </head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="xcontainer">
        <div class="navbar-header">
            <a class="navbar-brand" title="Go to Zynk.com" href="http://zynk.com"><img class="img-responsive" id="logo-main" src="assets/logo.svg" alt="Click here to visit Zynk.com" /></a>
        </div>
        <div id="myNavbar">
                <ul class="nav navbar-nav navbar-right">
                    <li class="topnav-2"><a href="mailto:support@zynk.com">support@zynk.com</a></li>
                </ul>
        </div>
    </div>
</nav>

<div id="wrapper">

    <!-- Sidebar -->
    <div id="sidebar-wrapper" class="sidebar-nav">
        
        <h1>Zynk Workflow Documentation</h1>
<ul>
  <li><a href="index">Home</a></li>
  <li>[[Introduction]]
    <ul>
      <li>[[Welcome]]</li>
      <li>[[Getting Started]]</li>
      <li>[[Key Concepts]]</li>
      <li>[[Using Zynk]]</li>
      <li>[[Settings]]</li>
      <li>[[Extensions]]</li>
      <li>[[Integrations]]</li>
    </ul>
  </li>
  <li>[[Accounting]]
    <ul>
      <li>[[Sage 50 UK]]</li>
      <li>[[Sage 200]]</li>
      <li>[[Sage 200 Online]]</li>
      <li>[[Xero]]</li>
      <li>[[Kashflow]]</li>
      <li>[[Quickbooks Online]]</li>
      <li>[[Sage 50 US]]</li>
      <li>[[Brightpearl]]</li>
      <li>[[Sage One]]</li>
      <li>[[Sage 50 Payroll]]</li>
      <li>[[Sage 50 UK Reporting]]</li>
    </ul>
  </li>
  <li>[[CRM]]
    <ul>
      <li>[[ACT]]</li>
      <li>[[AutoTask]]</li>
      <li>[[BXP]]</li>
      <li>[[Campaign Monitor]]</li>
      <li>[[ConnectWise]]</li>
      <li>[[Salesforce]]</li>
      <li>[[Sugar CRM]]</li>
      <li>[[Zoho CRM]]</li>
    </ul>
  </li>
  <li>[[Databases]]
    <ul>
      <li>[[SQL Server]]</li>
      <li>[[SQLite]]</li>
      <li>[[ODBC]]</li>
      <li>[[OLEDB]]</li>
    </ul>
  </li>
  <li>[[Ecommerce]]
    <ul>
      <li>[[Amazon Marketplace]]</li>
      <li>[[Amazon Vendor Central]]</li>
      <li>[[BigCommerce]]</li>
      <li>[[Channel Advisor]]</li>
      <li>[[CoreCommerce]]</li>
      <li>[[Easy Webstore]]</li>
      <li>[[Ebay]]</li>
      <li>[[EKM Powershop]]</li>
      <li>[[Magento V1]]</li>
      <li>[[Magento V2]]</li>
      <li>[[PayPal]]</li>
      <li>[[Shopify]]</li>
      <li>[[WooCommerce]]</li>
    </ul>
  </li>
  <li>[[Files]]
    <ul>
      <li>[[CSV]]</li>
      <li>[[HTML]]</li>
      <li>[[Excel]]</li>
      <li>[[File]]</li>
      <li>[[File Helpers]]</li>
      <li>[[JSON]]</li>
      <li>[[PDF]]</li>
      <li>[[XML and XSLT]]</li>
    </ul>
  </li>
  <li>[[Cloud]]
    <ul>
      <li>[[Amazon S3]]</li>
    </ul>
  </li>
  <li>[[Social]]
    <ul>
      <li>[[LinkedIn]]</li>
      <li>[[Twitter]]</li>
      <li>[[Facebook]]</li>
    </ul>
  </li>
  <li>[[Web]]
    <ul>
      <li>[[Email]]</li>
      <li>[[FTP]]</li>
      <li>[[SFTP]]</li>
      <li>[[HTTP]]</li>
    </ul>
  </li>
  <li>[[Other]]
    <ul>
      <li>[[Developer]]</li>
      <li>[[SMS]]</li>
      <li>[[User Interface]]</li>
      <li>[[WordPress]]</li>
      <li>[[Zynk Core]]</li>
    </ul>
  </li>
  <li>[[Contact Us]]</li>
</ul>

    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 markdown-body">
                    <a onclick="history.go(-1)" href="#"><span class="fa fa-arrow-left"></span>Back</a>
                    <h1>Exporting Custom Data from Sage 200 (V2)</h1>
                    <p>This task will export data from Sage 200 in XML format, as specified by an SQL Query. This is useful when there is no task which exports the data required.</p>

<p>The table and column names that can be used in the Query are determined by the Sage 200 database. They can be viewed using SQL Server Management Studio.</p>

<p><strong>Note</strong> - The information below applies to version 2 of the task. Workflows created using Zynk 2.0.3 or below will contain version 1 of this task, please see 
<a href="exporting-custom-data-from-sage-200">Exporting Custom Data from Sage 200</a> instead.</p>

<h2 id="settings">Settings</h2>
<h3 id="sage-200-connection">Sage 200 Connection</h3>
<p><em>Required</em><br />
The Sage 200 connection to use.  See the <a href="connecting-to-sage-200">Connecting to Sage 200</a> article if you require more information on how to create/manage connections.</p>

<h3 id="op-lock">Op Lock</h3>
<p><em>Required</em><br />
This setting stores the highest OpLock value from the records the task has exported. It will update automatically each time the task is ran, provided your query returns the OpLock column from the database.</p>

<p>The OpLock value can be used to export modified records only. The task will pass this value to SQL Server as a query parameter called ‘oplock’. You can use this in your query to only export records where the OpLock is greater than the value of this parameter. For example, the query below will only return customer accounts that have been modified since the task last ran.</p>

<p><code class="highlighter-rouge">SELECT * FROM SLCustomerAccount WHERE SLCustomerAccount.OpLock &gt; @oplock</code></p>

<h3 id="op-lock-aliases">Op Lock Aliases</h3>
<p><em>Optional</em><br />
If your query is joining to multiple tables, and you need to check for modified records across these tables, you can use this setting to specify the aliases used in the query for the OpLock columns from each table. These aliases will be taken into account when the Op Lock setting is automatically updated, and it will be set to the highest value across all the tables. For example when using the query below, you should add 	<code class="highlighter-rouge">ContactOpLock</code> to the list of aliases.</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span> <span class="p">[</span><span class="n">SLCustomerAccount</span><span class="p">].[</span><span class="n">SLCustomerAccountID</span><span class="p">],</span> <span class="p">[</span><span class="n">SLCustomerAccount</span><span class="p">].[</span><span class="n">OpLock</span><span class="p">],</span> <span class="p">[</span><span class="n">SLCustomerContact</span><span class="p">].[</span><span class="n">ContactName</span><span class="p">],</span> <span class="p">[</span><span class="n">SLCustomerContact</span><span class="p">].[</span><span class="n">OpLock</span><span class="p">]</span> <span class="k">AS</span> <span class="p">[</span><span class="n">ContactOpLock</span><span class="p">]</span>
<span class="k">FROM</span> <span class="p">[</span><span class="n">SLCustomerAccount</span><span class="p">]</span> 
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="p">[</span><span class="n">SLCustomerContact</span><span class="p">]</span> <span class="k">ON</span> <span class="p">[</span><span class="n">SLCustomerContact</span><span class="p">].[</span><span class="n">SLCustomerAccountID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">SLCustomerAccount</span><span class="p">].[</span><span class="n">SLCustomerAccountID</span><span class="p">]</span>
<span class="k">WHERE</span> <span class="p">[</span><span class="n">SLCustomerAccount</span><span class="p">].[</span><span class="n">OpLock</span><span class="p">]</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="o">@</span><span class="n">oplock</span> <span class="k">OR</span> <span class="p">[</span><span class="n">SLCustomerContact</span><span class="p">].[</span><span class="n">OpLock</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">@</span><span class="n">oplock</span>
</code></pre>
</div>
<h3 id="query">Query</h3>
<p><em>Required</em><br />
Enter the SQL query to run against the Sage 200 database.  E.g. <code class="highlighter-rouge">SELECT * FROM [SLCustomerAccount]</code>.  You can use the <a href="query-designer">Query Designer</a>.</p>

<h3 id="query-timeout">Query Timeout</h3>
<p><em>Optional</em><br />
Enter the length of time (in seconds) to allow the query to run for. If the query does not finish running before this time elapses, it will stop and an error will be reported back.</p>

<h3 id="output-file">Output File</h3>
<p><em>Required</em><br />
The file to save the results of the query to. The data will be saved in XML format.</p>

<h3 id="export-as-elements">Export as Elements</h3>
<p><em>Required</em><br />
Set to true to export the data as XML elements, or false to export data as XML attributes.</p>

<h3 id="root">Root</h3>
<p><em>Required</em><br />
The name to give the root element in the output XML file. Defaults to ‘Rows’.</p>

<h3 id="row">Row</h3>
<p><em>Required</em><br />
The name to give the XML element for each row returned by the SQL query. Defaults to ‘Row’.</p>

<h3 id="zynk-settings">Zynk Settings</h3>
<p>See <a href="common-task-settings">Common Task Settings</a></p>

<h2 id="examples">Examples</h2>
<p>Example query, which selects the customer account reference and contact name(s), for the customer account ABC001:</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">SELECT</span> <span class="p">[</span><span class="n">SLCustomerAccount</span><span class="p">].[</span><span class="n">CustomerAccountNumber</span><span class="p">],</span> <span class="p">[</span><span class="n">SLCustomerContact</span><span class="p">].[</span><span class="n">ContactName</span><span class="p">],</span> <span class="k">CONVERT</span><span class="p">(</span><span class="n">bigint</span><span class="p">,</span> <span class="p">[</span><span class="n">SLCustomerContact</span><span class="p">].[</span><span class="n">OpLock</span><span class="p">])</span> <span class="k">AS</span> <span class="p">[</span><span class="n">OpLock</span><span class="p">]</span> 
<span class="k">FROM</span> <span class="p">[</span><span class="n">SLCustomerAccount</span><span class="p">]</span> 
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="p">[</span><span class="n">SLCustomerContact</span><span class="p">]</span> <span class="k">ON</span> <span class="p">[</span><span class="n">SLCustomerContact</span><span class="p">].[</span><span class="n">SLCustomerAccountID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">SLCustomerAccount</span><span class="p">].[</span><span class="n">SLCustomerAccountID</span><span class="p">]</span>
<span class="k">WHERE</span> <span class="p">[</span><span class="n">CustomerAccountNumber</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'ABC001'</span>
</code></pre>
</div>

<p>Example output file when Export as Elements is set to false:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" standalone="yes"?&gt;</span>
<span class="nt">&lt;Rows&gt;</span>
  <span class="nt">&lt;Row</span> <span class="na">CustomerAccountNumber=</span><span class="s">"ABC001"</span> <span class="na">ContactName=</span><span class="s">"John Smith"</span> <span class="na">OpLock=</span><span class="s">"186136"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Row</span> <span class="na">CustomerAccountNumber=</span><span class="s">"ABC001"</span> <span class="na">ContactName=</span><span class="s">"Joe Bloggs"</span> <span class="na">OpLock=</span><span class="s">"127188"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Rows&gt;</span>
</code></pre>
</div>

<p>Example output file when Export as Elements is set to true:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" standalone="yes"?&gt;</span>
<span class="nt">&lt;Rows&gt;</span>
  <span class="nt">&lt;Row&gt;</span> 
    <span class="nt">&lt;CustomerAccountNumber&gt;</span>ABC001<span class="nt">&lt;/CustomerAccountNumber&gt;</span>
    <span class="nt">&lt;ContactName&gt;</span>John Smith<span class="nt">&lt;/ContactName&gt;</span>
    <span class="nt">&lt;OpLock&gt;</span>186136<span class="nt">&lt;/OpLock&gt;</span>
  <span class="nt">&lt;/Row&gt;</span>
  <span class="nt">&lt;Row&gt;</span>
    <span class="nt">&lt;CustomerAccountNumber&gt;</span>ABC001<span class="nt">&lt;/CustomerAccountNumber&gt;</span>
    <span class="nt">&lt;ContactName&gt;</span>Joe Bloggs<span class="nt">&lt;/ContactName&gt;</span>
    <span class="nt">&lt;OpLock&gt;</span>127188<span class="nt">&lt;/OpLock&gt;</span>
  <span class="nt">&lt;/Row&gt;</span>
<span class="nt">&lt;/Rows&gt;</span>
</code></pre>
</div>

                    <hr>
                    <div class="row">
                        <div class="col-sm-6"><a onclick="history.go(-1)" href="#"><span class="fa fa-arrow-left"></span>Back</a></div>
                        <div class="col-sm-6 text-right"><a href="http://github.com/Zynk-workflow/docs/tree/master/_documentation/Sage-200-Connector/Exporting-Custom-Data-from-Sage-200-(V2).md"><span class="fa fa-github"></span>Edit on Github</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /#page-content-wrapper -->
</div>
<!-- /#wrapper -->


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<!-- Menu Toggle Script -->
<script>
    $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>



<script>
    var screenWidth = $(window).width();

    // Add .active class to active link + scroll into view
    var pathinfo = location.pathname + location.hash;
    if (screenWidth > 768 && pathinfo != "/")
    {
        var scrollItem = $("#sidebar-wrapper").find("a[href='" + pathinfo + "']")
                .addClass('active')
                .parents().filter("div>ul>li")[0];
        if (scrollItem) {
            scrollItem.scrollIntoView({
                behavior: "smooth",
                block: "start"
            });
        }
    }

    // Add external link icon next to external menu links
    $(".sidebar-nav a[href^=http]")
        .append('<i class="fa fa-external-link" style="margin-left:-15px"></i>');

    $("#menu-toggle").click(function(){
        $("#sidebar-wrapper").scrollTop(0);
        $(this).toggleClass("fa-angle-down");
        $("#wrapper").toggleClass("menu-collapsed");
    });

    if (screenWidth <= 768) {
        $("#menu-toggle").click();            
    }

    //Allow clicking on non-linked headers to jump to its #href
    $("h2,h3,h4").click(function(){
        if (this.id && this.innerHTML.indexOf("<a") == -1) {
            location.href = "#" + this.id;
        }
    });

    
    
    //should no longer be needed now that we're referencing server-side /slug permalinks
(function () {
    "use strict";
    String.prototype.replaceAll = function(search, replacement) {
        var target = this;
        return target.split(search).join(replacement);
    };

    function fixDoubleBracketLinks(cssSelector) {
        var sidebarText = $(cssSelector)[0].innerHTML;
        var matches = sidebarText.match(/\[\[(.+?)\]\]/g);
        var result = sidebarText;
        if(matches != null) {
            for(var i = 0; i < matches.length; i++) {
                var text = matches[i].replaceAll('[[','').replaceAll(']]','');
                result = result.replace(matches[i],
                    '<a href="' +
                    encodeURIComponent(text.replaceAll(' ','-').toLocaleLowerCase()) +
                    '">' + text + '</a>')
            }
            $(cssSelector).html(result);
        }
    }

    fixDoubleBracketLinks('#page-content-wrapper');
    fixDoubleBracketLinks('#sidebar-wrapper');
})();
    
</script>
    
    
    
</body>
</html>
